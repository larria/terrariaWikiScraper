{{legacy nav tab}}
[[File:Valid House Door.png|thumb|一间基本的{{tr|House}}。<br/> 9（外部宽度）× 7（外部高度）]]

'''{{tr|House}}'''（或'''{{tr|home}}'''）是生成[[{{tr|Town NPC}}]] 所必需的由玩家建造的建筑物，每个 {{tr|NPC}} 都需要一间{{tr|House}}。建筑物需要满足一些要求才能作为{{tr|a House}}使用（见[[#{{tr|house}}有效性评估|下方]]）。玩家可以用[[#{{tr|housing menu}}|{{tr|housing menu}}]]来检查建筑物是否满足要求，或是将 {{tr|NPC}} 分配进已有的{{tr|House}}。如果被 {{tr|NPC}} 占用的{{tr|House}}受损而导致其不满足要求，{{tr|NPC}} 将从中搬出并在附近区域内走动，直到产生合适的{{tr|House}}。如果{{tr|world}}中有空余的{{tr|House}}，{{tr|NPC}} 可能会入住到其中的一间内。如果 {{tr|NPCs}} 被杀死且他没有家，他将在有可用的新{{tr|House}}后重生。

{{note|small=y|paren=y|译注：本文中使用的两个术语：入住（move in），指新的或失去房屋的 NPC 搬进一个{{tr|house}}这一事件；分配（assign），指使用{{tr|house}}菜单让世界中已经存在的 {{tr|NPC}} 住到一个{{tr|house}}中的行为。}}

如果{{tr|town NPCs}} 和他的{{tr|house}}都在屏幕外，他将会在[[{{tr|night}}]]、[[{{tr|rain}}]]、[[{{tr|Solar Eclipse}}]]、或[[{{tr|Slime Rain}}]]期间传送回他的{{tr|house}}。[[{{tr|Old Man}}]]若正站在[[{{tr|Dungeon Brick}}]]上，就也会被传送回{{tr|house}}，无论时间。{{tr|Old Man}}会将[[{{tr|Dungeon}}]]点（{{tr|Old Man}}的{{tr|spawn point}}，即他晚上所站的两格的左边那格）视为他的{{tr|house}}。{{source code ref|v=1.4.4.7|method=Terraria.NPC.AI_007_TownEntities}}{{source code ref|old=y|v=1.2.4.1|method=Terraria.NPC.AI}}

[[{{tr|Guide}}]]在常规的新世界一开启时就会出现，但如果他被杀死就需要有{{tr|House}}才能重生。[[{{tr|Old Man}}]]、[[{{tr|Traveling Merchant}}]]、[[{{tr|Skeleton Merchant}}]]不要求{{tr|Houses}}。

类似地，{{tr|Guide}}、[[{{tr|Angler}}]]、[[{{tr|Goblin Tinkerer}}]]、[[{{tr|Tavernkeep}}]]、[[{{tr|Mechanic}}]]、[[{{tr|Stylist}}]]、[[{{tr|Wizard}}]]、[[{{tr|Tax Collector}}]]、和[[{{tr|Golfer}}]]各自的最初出现和是否有可用{{tr|house}}无关。一旦首次发现他们后，每个人都需要有一个合适的{{tr|house}}才会重生。

某些自然生成的建筑物可作为{{tr|Houses}}，若玩家在其中放置[[{{tr|light source}}]]就可能会在不经意间吸引 {{tr|NPCs}}（如[[{{tr|Floating Island}}]]上的建筑物）。可以用{{tr|Housing Menu}}将住在其中的 {{tr|NPCs}} 搬到玩家的建筑物去。

玩家选定[[{{tr|Bed}}]]能作为[[{{tr|spawn point}}]]的要求与作为 {{tr|NPC housing}}的要求类似，但要宽松一些。玩家无需{{tr|the bed}}以外的其他家具。完整细节参见[[{{tr|Beds}}]]页面。

== 房屋菜单 ==
{{float file box|width=120px|[[File:Housing Menu Interface.png]]|{{tr|Housing menu}}}}
{{tr|The housing menu}}允许对 {{tr|NPCs}} 的位置进行管理。可以通过点击[[{{tr|inventory}}]]中{{tr|armor slots}}上方的小{{tr|house icon}}来访问。玩家可以检查一间{{tr|house}}是否适合 [[{{tr|NPC}}]] 使用，以及手动将{{tr|house}}分配给特定的 {{tr|NPC}}。

要检查{{tr|a house}}是否适合使用，在“?”{{tr|house}}查询标记上按下{{key|use}}，然后点击{{tr|the house}}内部的任何地方；玩家会收到一条[[{{tr|status message}}]]，表明此{{tr|the house}}是否适合。如果不适合，游戏会提示此{{tr|house}}缺了什么。该警告会优先考虑框架和{{tr|walls}}，然后是[[{{tr|furniture}}]]（{{tr|door}}、{{tr|light source}}、{{tr|table}}、和{{tr|chair}})。一条笼统的“{{gameText|LegacyInterface.40}}”提示可能是由于房屋的框架没有封闭，或者 {{tr|NPC}} 没有可用的站立点（见[[#家图格分值|下方章节]]）。如果查询的是{{tr|solid block}}，则会显示''“{{gameText|TownNPCHousingFailureReasons.RoomCheckStartedInASolidTile}}”''。

{{float file box|<p>[[File:NPC Flag.png]] &nbsp; [[File:NPC Flag2.png]]</p><p>[[File:Pet NPC Flag.png]] &nbsp; [[File:Pet NPC Flag2.png]]</p>|{{tr|NPC flag}}（上方）<br/>{{tr|Pet}}旗号（下方）}}
一旦{{tr|a house}}确定为合适，就可以通过在其中放置相应的 [[{{tr|NPC Flag}}]]来为其分配 {{tr|NPC}}。仅有已存在于世界中的那些 {{tr|NPC}} 的旗号才会出现。例如，首次进入新世界时，只会显示{{tr|the Guide}}的 {{tr|NPC Flag}}。其他 {{tr|NPCs}} 的 {{tr|NPC Flags}}只会在他们在世界中生成后才会显示。{{tr|NPC Flags}}有两种不同的外观：常规和带金色边框。自行入住的 {{tr|NPCs}} 会具有常规的旗号（{{tr|town NPCs}} 为红色，[[{{tr|town pets}}]]为紫色）。如果是分配了{{tr|house}}的，其旗号会带有金色边框。这指示着当前居住在这个家里的 {{tr|NPC}} 死亡后，其继任的 {{tr|NPC}} 将必定入住到此房屋中。

当第一次满足某个 {{tr|NPC}} 的生成条件时，会从可用的''合适''空{{tr|house}}中随机为其分配一间。

== 房屋有效性评估 ==
当 {{tr|NPCs}} 将要入住、玩家通过{{tr|housing menu}}为 {{tr|NPCs}}分配{{tr|houses}}、或玩家对一间{{tr|house}}使用{{tr|housing}}查询时，会对选中的{{tr|house}}进行房屋有效性评估。

如果房屋有效性评估是由{{tr|housing menu}}发起的，会出现特定的[[{{tr|status messages}}]]来告知玩家{{tr|house}}是否合适，或导致{{tr|house}}无效的原因。

[[{{tr|Liquids}}]]不影响{{tr|house}}的有效性。

包含[[{{tr|Stinkbug Blockers}}]]{{tr|Houses}}永远是无效的，且在被查询时会显示相应的{{tr|status message}}：
* {{tr|Stinkbug Blocker}}：''“{{gameText|TownNPCHousingFailureReasons.RoomHasAStinkbug}}”''
* {{tr|Ghostly Stinkbug Blocker}}：''“{{gameText|TownNPCHousingFailureReasons.RoomHasAnEchoStinkbug}}”''

房屋有效性评估可分成 3 个阶段：框架、家具、和属性。

=== 框架 ===
在这一阶段，游戏会尝试判定出{{tr|house}}的边框和内部区域，并且对其结构完成若干评估。{{source code ref|v=1.4.4.9|method=Terraria.WorldGen.StartRoomCheck}}
<section begin="framework" /><!-- transcluded on Guide:Bases -->{{tr|house}}的范围包括一块“连通”的内部区域和围绕着内部区域的“边框”，其中：

* 一个{{tr|tile}}可以在 8 个方向上“连通”，即{{tr|house}}内部区域中的{{tr|tile}}需要在水平方向、竖直方向、或斜角方向上彼此相连。
* “边框”是指围绕着内部{{tr|tiles}}的那些{{tr|tiles}}。边框必须完全封闭（即内部区域和边框外的任何{{tr|tile}}完全不连通）。边框必须由实心{{tr|tile}}（即未被[[{{tr|Actuator}}|致动]]的[[{{tr|blocks}}|{{tr|solid block}}]]或[[{{tr|platform}}]]）、[[{{tr|Trap Door}}]]、[[{{tr|Door}}]]、或[[{{tr|Tall Gate}}]]组成（仅有关门状态下所占据的那些{{tr|tiles}}才算作外框）。

{{tr|house}}范围内的所有{{tr|tiles}}（包括框架和内部区域），需要满足以下条件：

* 所有{{tr|tiles}}离真正[[{{tr|world}}边界]]必须有至少 10 个{{tr|tiles}}远。<ref>游戏内可见的{{tr|world}}边界到真正的{{tr|world}}边界的距离：上和左边界 41 格，下和右边界 42 格，因此这一条在正常游戏过程中应当不会触发。</ref>
* 范围内不允许存在水平或竖直方向上连续 5 格及以上{{tr|tiles}}的“洞”。“洞”指的是未被有效的{{tr|solid block}}占据同时又没有有效的{{tr|background wall}}的{{tr|tiles}}。
** [[{{tr|Unsafe wall}}]]（如自然生成的[[{{tr|Dirt Wall}}]]）''不''算作有效{{tr|background walls}}。
** 如果{{tr|Background Walls}}上有“洞”，有时会让{{tr|enemies}}在{{tr|the House}}之中生成。要打造更安全的窗户，建议使用[[{{tr|Glass Wall}}]]。
* {{tr|house}}的大小也有约束：包括边框和内部区域，总共的{{tr|tiles}}数量至少要有 60 个，同时要少于 750 个。<section end=framework />
* 下方为和框架检查相关的{{tr|status messages}}：{{source code ref|name=movetownnpc|v=1.4.4.9|method=Terraria.WorldGen.MoveTownNPC}}
** 若{{tr|house}}缺少太多的{{tr|background walls}}：''“{{gameText|TownNPCHousingFailureReasons.HoleInWallIsTooBig}}”''
** 若{{tr|house}}太小：''“{{gameText|TownNPCHousingFailureReasons.RoomIsTooSmall}}”''
** 若{{tr|house}}太大：''“{{gameText|TownNPCHousingFailureReasons.RoomIsTooBig}}”''

在决定{{tr|house}}的框架后，游戏会为接下来的检查保存两个区域：{{source code ref|v=1.4.4.9|method=Terraria.WorldGen.CheckRoom}}
* 整个{{tr|house}}区域。这包括所有内部{{tr|tiles}}和框架。这被用于检查[[#{{tr|Furniture}}|有效{{tr|furniture}}]]。
* {{anchor|internal}}{{tr|house}}内部的坐标。这包括排除所有框架{{tr|tiles}}后，最左与最右侧的{{tr|tile}}的 X 坐标（左侧 X1，右侧 X2），和最高与最低处的{{tr|tile}}的 Y 坐标（上方 Y1，下方 Y2）。这被用于检查[[#邪恶分值|邪恶分值]]和[[#家图格分值|家图格分值]]。

[[File:House areas.png|thumb|600px|left|整个{{tr|house}}区域（红色）和由内部坐标所创建的矩形（黄色）。]]

{{-}}

==== 最小的房屋尺寸 ====
[[File:Npccell.png|thumb|微型的 3×10 {{tr|house}}。]]
[[File:Simpliest Housing.png|thumb|一个简单的{{tr|valid house}}。]]

由于{{tr|house}}的最小大小为 60 格（包括框架），因此，矩形的{{tr|house}}尺寸必须满足以下最低要求之一：

{| class="terraria lined"
|-
! 不包括天花板、地板和墙 !! 包括天花板、地板和墙
|-
| 3 格宽 × 10 格高 <ref>仅当使用[[{{tr|Work Bench}}]]而非{{tr|table}}时才可能。</ref>|| 5 格宽 × 12 格高
|-
| 4 格宽 × 8 格高 || 6 格宽 × 10 格高
|-
| 5 格宽 × 7 格高 || 7 格宽 × 9 格高
|-
| 6 格宽 × 6 格高 || 8 格宽 × 8 格高
|-
| 7 格宽 × 5 格高 || 9 格宽 × 7 格高
|-
| 8 格宽 × 4 格高 || 10 格宽 × 6 格高
|-
| 10 格宽 × 3 格高 || 12 格宽 × 5 格高
|}

注意{{tr|house}}并不需要是矩形的。上方的尺寸仅作示例。

=== 家具 ===
在这一阶段，游戏会检测完整{{tr|house}}区域内是否有必要的[[{{tr|furniture}}]]。

{{tr|house}}范围内必须至少有一个有效的[[{{tr|light source}}]]、一个有效的[[{{tr|Flat-surface items}}]]、一个有效的{{tr|comfort item}}、和一个有效的入口。{{source code ref|v=1.4.4.9|method=Terraria.WorldGen.RoomNeeds}}符合条件的最小最简单的物品分别是[[{{tr|Torch}}]]、[[{{tr|Work Bench}}]]、[[{{tr|chair}}]]、和[[{{tr|Wood Platform}}]]各一个。所有可用物品的列表见下方。{{source code ref|v=1.4.4.9|class=Terraria.ID.Sets.RoomNeeds}}

* 并非所有提供光亮的{{tr|item}}都满足{{tr|a House}}的{{tr|light source}}要求；具体来说，任何{{tr|solid blocks}}、{{tr|platforms}}、或{{tr|walls}}都是不合格的。
* 入口并不需要是 {{tr|NPC}} ''可使用''的（例如，{{tr|NPC}} 并不能使用{{tr|trap doors}}），也并不需要通向“室外”（例如，放置在{{tr|house}}内的一个{{tr|platform}}也是可用的）。
* 下列每个物品的任何类型都满足要求。例如，任何颜色的[[{{tr|Torch}}]]都可以，任何主题的[[{{tr|Chair}}]]也一样。
* 如果{{tr|house}}缺少任何所需的{{tr|furniture}}，它会在{{tr|status message}}中被提及。<ref name="movetownnpc"/>
** 例如，对于没有任何{{tr|furniture}}的{{tr|house}}会出现''“{{gameText|Game.HouseMissing_4|x_0={{gameText|Game.HouseLightSource}}|x_1={{gameText|Game.HouseDoor}}|x_2={{gameText|Game.HouseTable}}|x_3={{gameText|Game.HouseChair}}}}”''
{{options/set|item|icons=n|small=y}}{{options/set|itemlist|width=14em}}{{options/set|eicons|small=y}}
{{infocard/start|class=terraria compact}}

{{infocard/mainheading|{{tr|Light sources}}}}{{anchor|{{tr|Light sources}}|toc=4}}

''任何{{$|Tile ID}}为 4、33、34、35、42、49、92、93、95、98、100、149、173、174、270、271、316、317、318、372、405、572、581、592、646、或 660 的物品：''
{{itemlist
|{{item|Torch|es}}
|{{item|Tiki Torch}}
|{{item|Candle|s}}
|{{item|Skull Lantern}}
|{{item|Candelabra|s}}
|{{item|Lamps|image=Golden Lamp.png}}
|{{item|Heart Lantern}}
|{{item|Lanterns|image=Golden Lantern.png}}
|{{item|Chandelier|s}}
|{{item|Fireplace}}
|{{item|Jack 'O Lantern}}
|{{item|Christmas lights|image=Blue Light.png}}
|{{item|Star in a Bottle}}
|{{item|Water Candle}}
|{{item|Jellyfish Jars|image=Blue Jellyfish Jar.png}}
|{{item|Lamp Post}}
|{{item|Lanterns|Souls in a Bottle|image=Soul of Light in a Bottle.png}}
|{{item|Peace Candle}}
|{{item|Hanging Brazier}}
|{{item|Shadow Candle}}
|{{item|Lavafly in a Bottle}}
|{{item|Faeling in a Bottle}}
}}

{{infocard/mainheading|平坦表面{{tr|items}}}}{{anchor|平坦表面{{tr|items}}|toc=4}}

''任何{{$|Tile ID}} 为 14、18、87、88、90、101、354、355、464、469、或 487 的物品：''
{{itemlist
|{{item|Table|s}}
|{{item|Dresser|s}}
|{{item|Work Bench|es}}
|{{item|Bathtub|s}}
|{{item|Bookcase|s}}
|{{item|Piano|s}}
|{{item|Alchemy Table}}
|{{item|Bewitching Table}}
|{{item|War Table}}
|{{item|Picnic Table}}
}}

{{infocard/mainheading|舒适性{{tr|items}}}}{{anchor|舒适性{{tr|items}}|toc=4}}

''任何{{$|Tile ID}} 为 15、79、89、102、487、或 497 的物品：''
{{itemlist
|{{item|Chair|s}}
|{{item|Toilet|s}}
|{{item|Bar Stool}}
|{{item|Bed|s}}
|{{item|Bench|es}}
|{{item|Sofa|s}}
|{{item|Chippy's Couch}}
|{{item|Throne}}
|{{item|Picnic Table}}
}}

{{infocard/mainheading|入口{{tr|items}}}}{{anchor|入口{{tr|items}}|toc=4}}

''任何{{$|Tile ID}} 为 10、11、19、386、387、388、389、427、435、436、437、438、或 439 的物品：''
{{itemlist
|{{item|Platform|s|image=Wood Platform.png}}
|{{item|Door|s}}
|{{item|Tall Gate}}
|{{item|Trap Door}}
}}

{{infocard/end}}
{{options/reset|item}}{{options/set|itemlist|reset}}{{options/reset|eicons}}

=== 属性 ===
经过以上的步骤，{{tr|house}}结构上似乎已经合格了，但仍可能有三种原因导致它变得无效：它已被占用；它太靠近或在[[{{tr|Evil biome}}]]中；它其中没有可供 {{tr|NPC}} 在{{tr|night}}站立的位置。

* 首先，检查{{tr|house}}是否已被其他 {{tr|NPC}} 入住占据。如果已有入住，则{{tr|house}}无效，并显示[[{{tr|status message}}]]''“{{gameText|LegacyInterface.41}}”''

* 否则，就会通过判定两种{{tr|house}}属性的方式来确认一个{{tr|house}}是否有效：邪恶分值，和{{tr|home tile}}分值。{{source code ref|name=scoreroom|v=1.4.4.9|method=Terraria.WorldGen.ScoreRoom}}

==== 邪恶分值 ====
然后，开始评估邪恶分值：

[[File:Evil score area.svg|thumb|right|邪恶分值区域示例（橙色矩形）。]]

* 所检查的区域基于[[#internal|{{tr|house}}的内部坐标]]，向外延伸。具体的延伸范围随游戏版本而有所不同，在 {{eil|1.4.4.9}} 中是：{{source code ref|v=1.4.4.9|method=Terraria.WorldGen.Housing_GetTestedRoomBounds}}
** 水平方向：以{{tr|house}}范围内最靠左/右的{{tr|tiles}}开始，各延伸 45 格（从 X1-45 到 X2+45）。
** 竖直方向：以{{tr|house}}范围内最靠上/下的{{tr|tiles}}为起点，向上延伸 42 格、向下延伸 45 格（从 Y1-42 到 Y2+45）。
* 如果以上区域四边中的任意边距离真正的[[{{tr|world}}边界]]小于 5 格，则收缩到距离{{tr|world}}边界 5 格处。 <ref>注意，此条在正常游戏中可能触发，因为评估区域的延伸距离长于{{tr|world}}可见边界和真正边界的距离（41 格）。</ref>
* 统计区域中的所有有效{{tr|tile}}（包括[[{{tr|Actuator}}|被致动的]]）的总分值，具体见下表：{{source code ref|v=1.4.4.9|method=Terraria.WorldGen.GetTileTypeCountByCategory}}
{| class="terraria lined mw-collapsible" style="width: 45%"
! style="width:60%" | {{tr|Tiles}} !! style="width:40%" | 对分值的影响
|- 
| {{item|Corrupt grass}} 
| rowspan="16" | 每格 +1 分
<!-- +1 point list: Tile ID = 23, 24, 25, 32, 112, 163, 199, 200, 203, 234, 352, 398, 399, 400, 401 -->
|-
| {{item|Ebonstone Block}}
|-
| {{item|Purple Ice Block}}
|-
| {{item|Ebonsand Block}}
|-
| {{item|Ebonsandstone Block}}
|-
| {{item|Hardened Ebonsand Block}}
|-
| {{item|Corruption thorny bushes|link={{tr|Thorny bushes}}|image=Corruption Thorny Bush.png}}
|-
| [[File:Corruption Plants.png|200px|link=野生草植物]] [[野生草植物|{{tr|Corruption Plants}}]]
|-
| {{item|Vile Mushroom|image=Vile Mushroom (placed).png}}
|-
| {{item|Crimson grass}}
|-
| {{item|Crimstone Block}}
|-
| {{item|Red Ice Block}}
|-
| {{item|Crimsand Block}}
|-
| {{item|Crimsandstone Block}}
|-
| {{item|Hardened Crimsand Block}}
|-
| {{item|Crimson thorny bushes|link={{tr|Thorny bushes}}|image=Crimson Thorny Bush.png}}
|-
| {{item|Hallowed grass}}
| rowspan="8" | 每格 -1 分
<!-- -1 point list: Tile ID = 109, 110, 113, 116, 117, 164, 402, 403 -->
|-
| {{item|Pearlstone Block}}
|-
| {{item|Pink Ice Block}}
|-
| {{item|Pearlsand Block}}
|-
| {{item|Pearlsandstone Block}}
|-
| {{item|Hardened Pearlsand Block}}
|-
| [[File:Short Hallowed Plants.png|200px|link=野生草植物]] [[野生草植物|矮{{tr|Hallowed plants}}]]
|-
| [[File:Tall Hallowed Plants.png|100px|link=野生草植物]] [[野生草植物|高{{tr|Hallowed plants}}]]<br/>{{note|small=y|paren=y|每株植物仅算作一格，虽然其外观上高两格。}}
|-
| {{item|Sunflower}}
| 每棵 -40 分<ref>每格 -5 分，每棵{{tr|Sunflower}}占 8 格</ref>
|}
* 最终计算：邪恶分值 = {{tr|Corruption tile}}分值 + {{tr|Crimson tile}}分值 + {{tr|Hallowed tile}}分值 + {{tr|Sunflower}}分值

如果邪恶分值至少为 50，则{{tr|house}}无效，并显示“{{gameText|LegacyInterface.42}}”，若邪恶分值至少为 300 时，则改为显示“{{gameText|LegacyInterface.40}}”当一间已被占用的房间被{{tr|Corruption}}/{{tr|Crimson}}化时，生活在其中的 [[{{tr|NPC}}]] 可能会搬出去并在此区域走动，直到有新的{{tr|House}}可用。

==== 家图格分值 ====
然后，开始检查{{tr|house}}内是否有有效的“{{tr|home tile}}”。{{tr|home tile}}会在一个基于[[#internal|{{tr|house}}的内部坐标]]所确定的矩形区域内选择。区域起始于最左和最右侧{{tr|tile}}向内 1 格，最上方{{tr|tile}}向下 2 格，最下方{{tr|tile}}向下延伸 1 格（从 X1+1 至 X2-1，从 Y1+2 至 Y2+1）。<ref name="scoreroom"/>

[[File:Home tile areas.png|thumb|500px|left|内部坐标所创建的矩形（黄色），和从中选择{{tr|home tile}}的区域（青色）。]]
{{-}}
[[File:Home Tile.png|thumb|200px|判定范围示例。]]

然后，所选{{tr|tile}}需要满足下方需求以成为有效的{{tr|home tile}}。图中紫色{{tr|tile}}作为待判定的{{tr|home tile}}：

* 它不能是[[{{tr|Platform}}]]或[[{{tr|Bubble}}]]。
* 它本身和它左侧和右侧直接相邻它的{{tr|tiles}}（蓝色{{tr|tile}}）必需是实心的未被致动的{{tr|tiles}}。
* 它正上方高 3 格，宽 3 格的范围内（绿色方框中的{{tr|tile}}）不能有影响通行的物体（即不允许有未致动的{{tr|solid block}}，但可以有{{tr|platform}}）。
* 它正上方 3 格（绿色方框中的黄色{{tr|tile}}）必须没有实心{{tr|tile}}，且这 3 格必须全部都在{{tr|house}}范围内。 

如果有符合以上条件的{{tr|tile}}，使用正上方 5×4 范围内（红色、白色、黄色{{tr|tile}}）的物体来计算“家图格分值”。“家图格分值”起始为 50。

* 区域内的大部分类型的实心{{tr|tiles}}（{{tr|blocks, furnitures}}，等等）都会影响{{tr|home tile}}分值。以下为不被包含在内的{{tr|tiles}}的列表：{{source code ref|v=1.4.4.9|field=Terraria.ID.TileID.Sets.IgnoredInHouseScore}}
{{infocard/start|class=terraria compact}}
{{infocard/mainheading|不包含的{{tr|tiles}}}}

''任何 {{$|Tile ID}}为 3、4、73、82、83、84、或 386 的{{tr|tile}}：''
{{itemlist|width=25em
|{{item|野生草植物|普通草和{{tr|tall grass}}{{tr|plants}}|image=Tall Grass Seeds (placed).png}}
|{{item|Mushroom|image=Growing mushroom.png}}
|{{item|Torch|es}}
|{{item|{{tr|Herbs}}#生长|任何生长阶段的{{tr|Herbs}}|image=Blinkroot (placed) (sprout).png/Deathweed (placed) (mature).png/Tiles 84 1.png}}
|{{item|Trap Door|note2=（开启）}}
}}
{{infocard/end}}

* 对于第一次计算，在正中间一列的（即{{tr|tile}}正上方 1×4 的范围；黄色{{tr|tile}}）不被使用，它们只参与第二次计算（见下方）。在此步骤中也无视[[{{tr|Chests}}]]，第二次计算才会考虑它们。
** 其余的 16 格（红色、白色{{tr|tile}}）参与第一次计算：
** 每一格关闭的[[{{tr|Door}}]]或[[{{tr|Tall Gate}}]] −20 分。
** 每一格开启的{{tr|Door}}的门轴部分（即关闭状态下{{tr|Door}}所占据的范围）{{source code ref|v=1.4.4.9|method=Terraria.WorldGen.IsOpenDoorAnchorFrame}}或开启的{{tr|Tall Gate}} −20 分。
** 每一格未致动的实心{{tr|tile}} −5 分。
** 每一格其他物体（或未被占用的格）+5 分。

在第一次计算后，若{{tr|home tile}}分值小于等于 0，则该{{tr|tile}}无效。若{{tr|home tile}}分值大于 0，则继续进行第二次计算：

* 如果正在将第二名 {{tr|NPC}} 分配到{{tr|house}}中，导致他们共享{{tr|house}}（{{tr|town NPC}} 和{{eil|Town pets}}），且当前格与已入住的那个 {{tr|NPC}} 的{{tr|home tile}}水平距离小于 3，那么分值会被直接设置为 1。
* 如果正上方除中间一列以外的 5×4 范围内（红色、白色{{tr|tile}}）有任何类型的常规{{tr|chest}}（{{tr|Trap Chests}}不算，但[[{{tr|Chest Lock}}|{{tr|Locked Chests}}]]算）{{source code ref|v=1.4.4.9|field=Terraria.ID.TileID.Sets.BasicChest}}，{{tr|chest}}每占用一个{{tr|tile}} −30 分。如果计算后分值小于 1，则设置为 1。
* 如果正上方 1×4 范围内（黄色{{tr|tile}}）有未被致动的{{tr|block}}<!-- Tile.nactive()：检查图格中是否有未致动图格 -->，每有一格就 −15 分。 <!-- 如果计算后分值是 0 或更低，将分值设置为 0。由于分值需要大于 0，家图格才有效，因此这一调整是否实际应用并不影响结果。-->
* 如果最终分值小于等于 0，此格不合格。

{{tr|house}}内必须至少有一格合格的{{tr|home tile}}作为 {{tr|NPC}} 的站立点，否则会显示''“{{gameText|LegacyInterface.40}}”''。[[{{tr|NPC Flag}}]]会挂在 {{tr|npc}} 站立点上方。如果有多个有效的{{tr|home tile}}，则会选择分数最高的{{tr|tiles}}中，最靠左上的那格。<ref>游戏会从上到下，从左到右依次检查房屋内{{tr|tile}}：如果比之前分数更高，则记录为候选；如果和之前分数相同或更低，则跳过。因此，当多个{{tr|tile}}并列最高时，最靠上、靠左的{{tr|tile}}会被选为{{tr|home tile}}。</ref>

当{{tr|house}}较小时，{{tr|town pet and a town NPC}}可能会共享同一个{{tr|home tile}}。不过，在将第二个 {{tr|NPC}} 分配进{{tr|house}}时，该{{tr|tile}}必须再通过一次检查。<ref>此前存在的{{tr|home tile}}可能会因{{tr|home tile}}分值检查中的第二次计算而变得无效，因此并非所有小{{tr|house}}的布局都能住下两名 {{tr|NPCs}}。</ref>

=== {{tr|Truffle}} ===
[[{{tr|Truffle}}]] {{tr|NPC}} 对他的{{tr|house}}有额外条件：其[[#框架|最低的{{tr|tile}}（Y2）]]必须高于[[{{tr|surface}}]]，且{{tr|house}}周围范围内必须有至少 100 格的[[{{tr|Glowing Mushroom biome}}]]{{tr|block}}。这一范围和[[#{{tr|邪恶分值}}|{{tr|用于计算邪恶分值的区域}}]]的大小相同。{{source code ref|v=1.4.4.9|method=Terraria.WorldGen.CheckSpecialTownNPCSpawningConditions}}

如果试图将{{tr|Truffle}}移动到不符合此需求的{{tr|house}}，会显示{{tr|status message}}：''“{{gameText|LegacyInterface.55}}{{tr|Truffle}}。”''

== 成就 ==
{{achievement|name=No Hobo}}
{{achievement|name=Real Estate Agent}}

== 备注 ==
[[File:House (no empty wall).png|thumb|200px|两个没有空{{tr|wall}}区域的{{tr|house}}示例。{{tr|NPCs}} 不能自己入住到这些{{tr|houses}}中，必须由玩家分配。]]

* 增加世界中空{{tr|houses}}内的空{{tr|wall}}区域（即只有{{tr|background wall}}，没有其它[[放置|{{tr|solid block}}/{{tr|background object}}]]的{{tr|tiles}}）的大小会使 {{tr|NPC}} 入住更快。此外，使用[[{{tr|Sandstone Brick Wall}}]]会将 {{tr|NPCs}} 入住需花费的时间增加。{{source code ref|v=1.4.4.9|method=Terraria.WorldGen.TrySpawningTownNPC/Terraria.WorldGen.SpawnTownNPC|t=对于任何有效的{{tr|housing walls}}，入住几率为 {{chance|1/1}}，而{{tr|Sandstone Brick Walls}}具有 {{chance|1/4}} 几率。}}
** 这意味着没有空{{tr|wall}}区域的{{tr|house}}只能被玩家分配 {{tr|NPC}}。
* {{tr|Houses}}可以连在一起并共用公共墙壁、地板、天花板、和门。对于玩家看来像一座有多个房间的房屋或者公寓的结构，在 {{tr|NPC}} 看来是一堆互相独立的{{tr|house}}。
*几乎所有 {{tr|NPC house}}都符合玩家放置{{tr|Bed}}并将其用作{{tr|spawn point}}所需的条件，只要{{tr|bed}}正上方的{{tr|tile}}是清空的即可（完整细节，参见[[{{tr|Beds}}]]页面）。{{tr|The Bed}}也算作{{tr|comfort item}}。
* 如果已分配给 {{tr|NPC}} 的{{tr|a House}}被摧毁或有任何要求变为无效状态，{{tr|NPC}} 会在此区域走动直到重新有可用的有效{{tr|house}}。如果 {{tr|NPC}} 被杀死，他会在有效的{{tr|house}}恢复了之后立刻重生。
* 当{{tr|house}}处于可见屏幕内时，{{tr|An NPC}} 不会在{{tr|House}}内重生，取而代之的是在屏幕外面的区域走动。在{{tr|night}}，如果玩家移动到几个屏幕之外，或使用任何[[{{tr|Magic Mirror}}]]或[[{{tr|Teleporter}}]]，{{tr|NPCs}} 们会自动进入他们的{{tr|Houses}}中。
* {{tr|world}}的边缘不算作{{tr|house}}的框架的一部分。
* 如果{{tr|background wall}}由于[[{{tr|biome spread}}]]而被转化（如[[{{tr|Stone Wall}}]]变为[[{{tr|Pearlstone Wall}}]]），{{tr|house}}将会变得无效，因为被转化的{{tr|wall}}被视为[[{{tr|unsafe wall}}|不安全]]的。

== 小贴士 ==
[[File:Infinite NPC House.png|thumb|{{anchor|无限{{tr|house}}}}{{anchor|infinite house}}一个无限{{tr|house}}。从 {{eil|1.3.1}} 开始这不再可用。]]
[[File:Minimum house.png|100px|thumb|拥有较少的{{tr|walls}}的有效{{tr|house}}。]]

* 在[[{{tr|Corruption}}]]或[[{{tr|Crimson}}]][[{{tr|Biomes}}|{{tr|biome}}]]中的{{tr|house}}通常是无效的。这会让购买有{{tr|biome}}需求的物品（尤其是[[{{tr|Painter}}]]）需要折腾一番才能满足。对于此种情况，建议使用[[{{tr|King Statue}}]]或[[{{tr|Queen Statue}}]]将 {{tr|NPC}} 传送以购买物品。
** 如果没有{{tr|King Statue}}或{{tr|Queen Statues}}，可以在邪恶分值判定区域外且仍然处于{{tr|evil biome}}中（{{tr|evil biome}}的{{tr|background}}可见）的位置建造{{tr|house}}，它将仍然是上述{{tr|biome}}中的有效{{tr|house}}。
* [[{{tr|Actuator}}]]可以和蓝、棕、灰、丛林蜥蜴[[{{tr|Pressure Plates}}]]共同使用来让玩家可以进入，同时阻止{{tr|enemies}}进入和 {{tr|NPCs}} 外出。但是，如果致动后的墙维持打开状态，这可能让{{tr|house}}变得无效，直到再次将其变得实心为止。
** 也可以用[[{{tr|Trap Door}}]]，{{tr|enemies}}和 {{tr|NPCs}} 都打不开它。
** 用[[{{tr|Sensor}}|“玩家上方”{{tr|Sensor}}]]来代替{{tr|pressure plates}}会很有用且很方便。这不仅可以节约一些可用地板空间，还能避免因为意外踩踏而让入口意外开启。''警告''：{{tr|Sensor}}自身''不是''有效的房屋框架{{tr|block}}；如果将其用作地板、天花板、或侧墙（包括拐角）的一部分，则{{tr|the house}}会变得无效。
* 若需要，玩家可以通过摧毁所有其余{{tr|house}}的方式强制让某个 {{tr|NPC}} 进入特定的{{tr|house}}。
* 在{{tr|house}}符合大小要求的同时，它可以是任何形状的，而并不仅限于长方形或正方形。（例如，圆顶{{tr|house}}依然有效。）
* 明智的做法是在当前 {{tr|NPC}} 数量之外建造一些“备用”{{tr|house}}：
** 任何新 {{tr|NPCs}} 一旦生成或被（可能是意料之外地）找到立刻就能搬进来。
** 特别是在进入{{tr|Hardmode}}时，一些{{tr|houses}}可能会因{{tr|Corruption}}或{{tr|Crimson}}而变得无效，有备用的{{tr|house}}有助于避免 {{tr|NPCs}} 变得无家可归。
** 在每个基地中都有额外的{{tr|house}}对于四处移动 {{tr|NPCs}} 来管理[[{{tr|happiness}}]]会有所帮助，并有助于确保[[{{tr|Pylons}}]]维持可用。
* 在{{tr|underground}}建造{{tr|house}}时，[[{{tr|Sticky Bomb}}]]或[[{{tr|Scarab Bomb}}]]是不错的选择，因为它们较为精准，且能够破坏[[{{tr|Background Walls}}]]以更方便地替换{{tr|wall}}。
* 虽然将所有 {{tr|NPCs}} 塞入小{{tr|houses}}的做法可能很诱人，但这为装饰或装备留下的空间很少。许多[[{{tr|crafting stations}}]]是 3 格宽 3 格高的，随着游戏推进，玩家还能获得最大 6 格宽 4 格高的[[{{tr|paintings}}]]和[[{{tr|animal skins}}]]，以及 3 格宽、最多 6 格高的{{tr|potted plants}}。
* {{tr|Houses}}是玩家挥洒创意的好地方。为 {{tr|NPCs}} 提供经过装修及主题化的家可以是很有意思的，虽然空荡荡的房间也足以让他们满意。[[{{tr|Happiness}}|{{tr|NPC happiness}}系统]]则基于这种乐趣来源使 {{tr|NPCs}} 对其{{tr|house}}的位置和与其他 {{tr|NPCs}} {{tr|house}}的距离有所偏好。虽说如此，{{tr|NPC}} 的{{tr|happiness}}并''不受''{{tr|house}}的外观或装修所影响，从而让玩家在这方面能不受约束自由发挥。

== 花絮 ==
* 有{{tr|tiles}}位于距离真正{{tr|world}}边界 5 格以内的{{tr|house}}被视为无效的，对应{{tr|status message}}为''“{{gameText|TownNPCHousingFailureReasons.TooCloseToWorldEdge}}”''不过，这一条件无法达成（除非外部编辑{{tr|world}}），因为在游戏内的可见[[{{tr|world}}边界]]和真正{{tr|world}}边界之间的距离为 41 或 42 格。

== 另见 ==
* [[指南:基地]]

== 历史 ==
{{history|Desktop 1.4.0.1|[[{{tr|Chippy's Couch}}]]现在可以在{{tr|house}}中用作{{tr|comfort item}}。}}
{{history|Desktop 1.3.5.3|修正了在某些语言中试图在不合适的房间上使用房间查询时出现的错误。}}
{{history|Desktop 1.3.5|对于手工分配房间的 {{tr|NPC}}，如果之前那个被杀，其继任会尝试搬进同一间房间内。}}
{{history|Desktop 1.3.2|修正了[[{{tr|Team Platforms}}]]不能作为{{tr|house}}的有效门的问题。}}
{{history|Desktop 1.3.1|修正了“无限{{tr|house}}”漏洞。}}
{{history|Desktop 1.3.0.5|[[{{tr|Living Leaf Wall}}]]现在可以作为{{tr|house}}的[[{{tr|wall}}|{{tr|background wall}}]]。}}
{{history|Desktop 1.3.0.1|来自[[{{tr|Dungeon}}]]的[[{{tr|Blue Slab Wall}}]]现在对于{{tr|Houses}}也算作有效。}}
{{history|Desktop 1.2.4.1|开着的[[{{tr|door}}]]再次可能导致房间变为不合适，但仅限于向同一个房间开两扇{{tr|doors}}的情况（依赖于房间的大小）。}}
{{history|Desktop 1.2|修正了一个会导致合适的{{tr|house}}变为不合适的 {{tr|bug}}。}}
{{history|Desktop 1.1|现在有{{tr|Housing Menu}}（一个游戏内界面）用来检查{{tr|a house}}是否有效可用于入住，并可将 [[{{tr|NPC}}]] 分配到特定的{{tr|houses}}中。}}
{{history|Desktop 1.0.6|要求有所修改；现在可以用[[{{tr|Bed}}]]、[[{{tr|Toilet}}]]、[[{{tr|Throne}}]]、或[[{{tr|Bench}}]]代替[[{{tr|chair}}]]，以及可以用[[{{tr|Dresser}}]]、[[{{tr|Bathtub}}]]、或[[{{tr|Bookcase}}]]代替[[{{tr|table}}]]或[[{{tr|Work Bench}}]]。}}

== 参考 ==
{{reflist}}

[[Category:环境]]

{{language info|en=House}}